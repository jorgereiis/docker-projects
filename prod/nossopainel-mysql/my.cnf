# ============================================
# Configurações MySQL para Nosso Painel Gestão
# Otimizado para produção com segurança máxima
# ============================================

[mysqld]

# ============================================
# SEGURANÇA
# ============================================

# Bind apenas para rede interna Docker (não expor para internet)
# Docker gerencia o isolamento, mas garantimos aqui também
bind-address = 0.0.0.0

# Requer SSL para conexões (desabilitado para rede Docker interna)
# require_secure_transport = OFF

# Desabilitar LOAD DATA LOCAL INFILE (segurança)
local_infile = 0

# Modo SQL estrito (evita dados inválidos)
sql_mode = STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO

# ============================================
# CHARSET E COLLATION
# ============================================

# UTF8MB4 para suportar emojis e caracteres internacionais
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ============================================
# PERFORMANCE E CONEXÕES
# ============================================

# Máximo de conexões simultâneas
# Django usa connection pooling (CONN_MAX_AGE=600)
# 3 workers Gunicorn + 1 scheduler + margem de segurança
max_connections = 50

# Tempo máximo de espera para conexão inativa (8 horas)
wait_timeout = 28800
interactive_timeout = 28800

# Tamanho do buffer pool InnoDB (70% da RAM disponível para MySQL)
# Ajuste conforme RAM do servidor (ex: 512M para servidor com 1GB RAM)
innodb_buffer_pool_size = 512M

# Tamanho do log buffer
innodb_log_buffer_size = 16M

# Tamanho dos arquivos de log
innodb_log_file_size = 128M

# Flush log a cada transação (ACID compliance)
innodb_flush_log_at_trx_commit = 1

# ============================================
# LOGS E MONITORAMENTO
# ============================================

# Log de erros
log_error = /var/log/mysql/error.log

# Slow query log (queries > 2 segundos)
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2

# Log de queries que não usam índices
log_queries_not_using_indexes = 1

# Limitar o número de slow queries logadas por minuto
log_throttle_queries_not_using_indexes = 10

# ============================================
# INNODB
# ============================================

# Engine padrão
default_storage_engine = InnoDB

# File per table (melhor performance e gerenciamento)
innodb_file_per_table = 1

# Flush method (melhor performance em Linux)
innodb_flush_method = O_DIRECT

# Número de threads para operações de I/O
innodb_read_io_threads = 4
innodb_write_io_threads = 4

# ============================================
# CACHE E BUFFERS
# ============================================

# Query cache (desabilitado no MySQL 8.0, removido)
# query_cache_type = 0

# Tamanho do buffer de ordenação
sort_buffer_size = 2M

# Tamanho do buffer de join
join_buffer_size = 2M

# Tamanho do buffer de leitura
read_buffer_size = 1M

# ============================================
# TABELAS TEMPORÁRIAS
# ============================================

# Tamanho máximo de tabelas temporárias em memória
tmp_table_size = 32M
max_heap_table_size = 32M

# ============================================
# TIMEZONE
# ============================================

# Define timezone padrão
default_time_zone = '-03:00'

[mysql]
# Cliente MySQL
default-character-set = utf8mb4

[client]
# Configurações do cliente
default-character-set = utf8mb4
